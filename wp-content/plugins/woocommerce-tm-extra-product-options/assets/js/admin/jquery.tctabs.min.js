!function(t){"use strict";var e=t.epoAPI.util.getStorage("localStorage"),a=window.confirm;t.fn.tcTabs=function(s){var d,o=this,i=[],n=[];if(0!==o.length)return s=t.extend({headers:".tm-tab-headers",header:".tab-header",addheader:".tm-add-tab",classdown:"tcfa-angle-down",classup:"tcfa-angle-up",animationclass:"appear",dataattribute:"data-id",dataopenattribute:"data-id",selectedtab:"auto",showonhover:!1,useclasstohide:!0,afteraddtab:null,beforemovetab:null,aftermovetab:null,deletebutton:!1,deletebuttonhtml:'<h4 class="tm-del-tab"><span class="tcfa tcfa-times"></span></h4>',deleteheader:".tm-del-tab",deleteconfirm:!1,beforedeletetab:null,afterdeletetab:null},s),d=function(d,o,r,l){var c="";l.on("closetab.tmtabs",function(){var e=d.find(t(this).data("tab"));t(this).removeClass("closed open").addClass("closed"),t(this).find(".tm-arrow").removeClass(s.classdown+" "+s.classup).addClass(s.classdown),s.useclasstohide?e.addClass("tm-hide").removeClass("tm-show"):e.hide(),e.removeClass("tm-animated "+s.animationclass),t(window).trigger("tc-closetab.tmtabs",{header:t(this),tab:e})}),l.on("opentab.tmtabs",function(){var e=d.find(t(this).data("tab"));t(this).removeClass("closed open").addClass("open"),t(this).find(".tm-arrow").removeClass(s.classdown+" "+s.classup).addClass(s.classup),s.useclasstohide?e.removeClass("tm-hide").addClass("tm-show"):e.show(),e.removeClass("tm-animated "+s.animationclass).addClass("tm-animated "+s.animationclass),n[o]=t(this).data("tab"),t(window).trigger("tc-opentab.tmtabs",{header:t(this),tab:n[o],table:e})}),!0!==s.showonhover&&"function"!=typeof s.showonhover||(c=" mouseover"),l.on("keydown.tmtabs",function(e){var a,d=t(this);13===e.keyCode&&t(this).trigger("click.tmtabs"),40===e.keyCode&&(a=t(this).closest(".tm-box").next().find(s.header)),38===e.keyCode&&(a=t(this).closest(".tm-box").prev().find(s.header)),a&&a.length&&(d.blur(),a.focus().trigger("click"),e.preventDefault())}),l.on("click.tmtabs"+c,function(a){a.preventDefault(),("mouseover"!==a.type||"function"!=typeof s.showonhover||s.showonhover.call())&&(n[o]!==t(this).data("tab")?(i[o]&&t(i[o]).trigger("closetab.tmtabs"),t(this).trigger("opentab.tmtabs"),i[o]=t(this),e&&e.setItem("tmadmintab-"+r,t(this).attr(s.dataopenattribute)),t(window).trigger("tc-tmtabs-clicked",{tc:r,options:s,header:t(this),tab:n[o],table:d.find(n[o])})):t(window).trigger("tc-isopentab.tmtabs",{header:t(this),tab:n[o],table:d.find(n[o])}))}),s.deletebutton&&(l.after(s.deletebuttonhtml),l.closest(".tm-box").find(s.deleteheader).on("click.tmtabs",function(){var e,o;d.find(s.headers+" "+s.header).length<2||s.deleteconfirm&&!a(window.TMEPOGLOBALADMINJS.i18n_builder_delete)||(e=t(this),o=d.find("."+e.closest(".tm-box").find(s.header).attr(s.dataattribute)),"function"==typeof s.beforedeletetab&&s.beforedeletetab.call(d,e,o),o.remove(),e.closest(".tm-box").remove(),"function"==typeof s.afterdeletetab&&s.afterdeletetab.call(d))}))},o.each(function(a){var o,r,l=t(this),c=l.attr("class"),m=l.find(s.headers+" "+s.header),b=0,h="",f=0,u=0,p={};0!==m.length&&(window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,a){p[e]=a}),i[a]=!1,n[a]="",l.data("tm-has-tmtabs",1),m.each(function(e,o){var r;r="."+(o=t(o)).attr(s.dataattribute),o.data("tab",r),s.useclasstohide?l.find(r).addClass("tm-hide").removeClass("tm-show"):l.find(r).hide(),l.find(r).data("state","closed"),!f&&o.is(".open")?(o.removeClass("closed open").addClass("open").data("state","open"),o.find(".tm-arrow").removeClass(s.classdown+" "+s.classup).addClass(s.classup),s.useclasstohide?l.find(r).removeClass("tm-hide").addClass("tm-show"):l.find(r).show(),l.find(r).data("state","open"),f=1,n[a]=r,i[a]=o):o.removeClass("closed open").addClass("closed").data("state","closed"),d(l,a,c,o)}),l.find(s.headers+":not(.section_elements "+s.headers+",.tm-settings-wrap "+s.headers+",.builder_element_wrap "+s.headers+")").sortable({containment:"parent",cursor:"move",items:".tm-box:not(.tm-add-box)",start:function(e,a){var d;d=l.find("."+a.item.closest(".tm-box").find(s.header).attr(s.dataattribute)),b=a.item.index(),h=a.item.find(s.header).attr("data-id"),r=t.tmEPOAdmin.find_index(!0,d.find(".bitem").first()),"function"==typeof s.beforemovetab&&s.beforemovetab.call(this,b,d,r)},stop:function(e,a){var d,o,i,n,c=l.find(s.headers+" "+s.header);n=l.find("."+a.item.closest(".tm-box").find(s.header).attr(s.dataattribute)),c.each(function(e){t(this).html(parseInt(e,10)+1)}),d=l.find(".tm-slider-wizard-tab."+h),o=l.find(s.headers+" "+s.header+"[data-id='"+h+"']").parent().index(),i=l.find(".tm-slider-wizard-tab").eq(o),o>b?i.after(d):o<b&&i.before(d),"function"==typeof s.aftermovetab&&s.aftermovetab.call(this,o,b,n,r)},cancel:".tm-add-box",forcePlaceholderSize:!0,tolerance:"pointer"}),l.find(s.addheader).on("click.tmtabs",function(t){var e=l.find(s.headers+" "+s.header).last(),o=e.attr(s.dataattribute),i=l.find("."+o),n=e.tcClone().off("closetab.tmtabs opentab.tmtabs click.tmtabs"),r=i.tcClone().empty(),m=o+"-"+u;t.preventDefault(),u+=1,n.html(l.find(s.headers+" "+s.header).length+1).removeClass("closed open").addClass("closed").data("tab","."+m).data("state","closed").attr(s.dataattribute,m),r.removeClass(o).addClass(m),s.useclasstohide?r.addClass("tm-hide").removeClass(".tm-show"):r.hide(),r.removeClass("tm-animated "+s.animationclass),e.closest(".tm-box").after(n),n.wrap('<div class="tm-box"></div>'),d(l,a,c,n),i.after(r),"function"==typeof s.afteraddtab&&s.afteraddtab.call(this,n,r)}),"auto"===s.selectedtab?(e&&(o=e.getItem("tmadmintab-"+c)),void 0!==p.selected_tab&&(o=p.selected_tab),void 0!==o&&null!==o||(o=t(s.header).eq(0).attr(s.dataopenattribute)),t(s.header+"["+s.dataopenattribute+'="'+o+'"]').is(":visible")?t(s.header+"["+s.dataopenattribute+'="'+o+'"]').trigger("click.tmtabs"):t(s.header).eq(0).trigger("click.tmtabs")):!1!==s.selectedtab&&(o=parseInt(s.selectedtab,10),l.find(s.header+":eq("+o+")").trigger("click.tmtabs")))})},t.fn.tmtabs=t.fn.tcTabs}(window.jQuery);